<!-- âœ… START EPG SECTION FOR ASTRO RIA -->
<div id="epg-astro-ria" class="epg-box">
  <p>Muatkan jadual rancangan Astro Ria...</p>
</div>

<style>
  .epg-box {
    background: #111;
    color: #eee;
    padding: 20px;
    border-radius: 12px;
    margin-top: 30px;
    font-family: Arial, sans-serif;
  }
  .epg-box h3 {
    font-size: 1.2rem;
    margin-bottom: 12px;
    border-bottom: 1px solid #444;
    padding-bottom: 6px;
    color: #0ff;
  }
  .epg-item {
    margin-bottom: 14px;
    padding-bottom: 8px;
    border-bottom: 1px dotted #333;
  }
  .epg-item strong {
    color: #ffd700;
  }
  .epg-item small {
    display: block;
    color: #ccc;
    margin-top: 4px;
    line-height: 1.4;
  }

.epg-item.now-playing {
  background-color: #222;
  border-left: 4px solid #0f0;
  padding-left: 10px;
}

.epg-item .badge {
  background: #0f0;
  color: #000;
  font-size: 0.8rem;
  padding: 2px 6px;
  display: inline-block;
  margin-top: 5px;
  border-radius: 4px;
}

</style>

<script>
  fetch("https://epg.tvmalaysia.workers.dev/?channel=104.astro")
    .then(res => res.json())
    .then(data => {
      const epgBox = document.getElementById("epg-astro-ria");

      const now = new Date();

      // Convert current Malaysia time manually to YYYYMMDD
      const nowMY = new Date(now.getTime() + (8 * 60 * 60 * 1000));
      const todayMY = nowMY.toISOString().slice(0,10).replace(/-/g, "");

      const filtered = data.filter(item => item.start.slice(0, 8) === todayMY);

      if (filtered.length === 0) {
        epgBox.innerHTML = "<p>Tiada jadual rancangan untuk hari ini.</p>";
        return;
      }

      const html = filtered.map(item => {
        // Parse manually the time with GMT+8
        const parseMY = (raw) => {
          const year = raw.slice(0, 4);
          const month = raw.slice(4, 6);
          const day = raw.slice(6, 8);
          const hour = raw.slice(8, 10);
          const minute = raw.slice(10, 12);
          const second = raw.slice(12, 14);
          return Date.UTC(year, month - 1, day, hour, minute, second) + (8 * 60 * 60 * 1000); // +8 jam
        };

        const startTime = parseMY(item.start);
        const stopTime = parseMY(item.stop);
        const isNowPlaying = now.getTime() >= startTime && now.getTime() < stopTime;

        const hour = parseInt(item.start.slice(8,10));
        const minute = item.start.slice(10,12);
        const ampm = hour >= 12 ? 'PM' : 'AM';
        const hour12 = hour % 12 === 0 ? 12 : hour % 12;
        const formattedTime = `${hour12}:${minute} ${ampm}`;

        return `
          <div class="epg-item${isNowPlaying ? ' now-playing' : ''}">
            <strong>${formattedTime}</strong> - ${item.title}
            <small>${item.desc}</small>
            ${isNowPlaying ? '<div class="badge">âœ… Sedang Bersiaran</div>' : ''}
          </div>
        `;
      }).join('');

      epgBox.innerHTML = `<h3>ðŸ“º Jadual Rancangan Astro Ria (Hari Ini)</h3>${html}`;
    })
    .catch(error => {
      console.error("EPG Fetch Error:", error);
      document.getElementById("epg-astro-ria").innerHTML = "<p>Gagal memuatkan jadual rancangan.</p>";
    });
</script>


<!-- âœ… END EPG SECTION -->
