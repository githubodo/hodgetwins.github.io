<!-- âœ… START EPG SECTION FOR ASTRO RIA -->
<div id="epg-astro-ria" class="epg-box">
  <p>Muatkan jadual rancangan Astro Ria...</p>
</div>

<style>
  .epg-box {
    background: #111;
    color: #eee;
    padding: 20px;
    border-radius: 12px;
    margin-top: 30px;
    font-family: Arial, sans-serif;
  }
  .epg-box h3 {
    font-size: 1.2rem;
    margin-bottom: 12px;
    border-bottom: 1px solid #444;
    padding-bottom: 6px;
    color: #0ff;
  }
  .epg-item {
    margin-bottom: 14px;
    padding-bottom: 8px;
    border-bottom: 1px dotted #333;
  }
  .epg-item strong {
    color: #ffd700;
  }
  .epg-item small {
    display: block;
    color: #ccc;
    margin-top: 4px;
    line-height: 1.4;
  }

.epg-item.now-playing {
  background-color: #222;
  border-left: 4px solid #0f0;
  padding-left: 10px;
}

.epg-item .badge {
  background: #0f0;
  color: #000;
  font-size: 0.8rem;
  padding: 2px 6px;
  display: inline-block;
  margin-top: 5px;
  border-radius: 4px;
}

</style>

<script>
  fetch("https://epg.tvmalaysia.workers.dev/?channel=104.astro")
    .then(res => res.json())
    .then(data => {
      const epgBox = document.getElementById("epg-astro-ria");

      const now = new Date();
      console.log("ðŸ•’ SEKARANG:", now.toString());

      const todayMY = new Intl.DateTimeFormat('en-GB', {
        timeZone: 'Asia/Kuala_Lumpur',
        year: 'numeric',
        month: '2-digit',
        day: '2-digit'
      }).format(now).split('/').reverse().join('');

      const filtered = data.filter(item => {
        const startDate = item.start.slice(0, 8);
        return startDate === todayMY;
      });

      if (filtered.length === 0) {
        epgBox.innerHTML = "<p>Tiada jadual rancangan untuk hari ini.</p>";
        return;
      }

      const html = filtered.map(item => {
        const fixTZ = (str) => str.replace(/(\d{2})(\d{2})$/, '+$1:$2');

        const startRaw = item.start;
        const stopRaw = item.stop;

        const startISO = `${startRaw.slice(0,4)}-${startRaw.slice(4,6)}-${startRaw.slice(6,8)}T${startRaw.slice(8,10)}:${startRaw.slice(10,12)}:${startRaw.slice(12,14)}${fixTZ(startRaw.slice(14))}`;
        const stopISO  = `${stopRaw.slice(0,4)}-${stopRaw.slice(4,6)}-${stopRaw.slice(6,8)}T${stopRaw.slice(8,10)}:${stopRaw.slice(10,12)}:${stopRaw.slice(12,14)}${fixTZ(stopRaw.slice(14))}`;

        const startTime = new Date(startISO);
        const stopTime = new Date(stopISO);

        const isNowPlaying = now >= startTime && now < stopTime;

        // DEBUG LOG
        console.log("ðŸŽ¬", item.title);
        console.log("   Start:", startTime.toString());
        console.log("   Stop :", stopTime.toString());
        console.log("   Now  :", now.toString());
        console.log("   Active:", isNowPlaying);
        console.log("--------------------------");

        const rawTime = item.start.slice(8, 12);
        const hour = parseInt(rawTime.slice(0, 2));
        const minute = rawTime.slice(2, 4);
        const ampm = hour >= 12 ? 'PM' : 'AM';
        const hour12 = hour % 12 === 0 ? 12 : hour % 12;
        const formattedTime = `${hour12}:${minute} ${ampm}`;

        return `
          <div class="epg-item${isNowPlaying ? ' now-playing' : ''}">
            <strong>${formattedTime}</strong> - ${item.title}
            <small>${item.desc}</small>
            ${isNowPlaying ? '<div class="badge">âœ… Sedang Bersiaran</div>' : ''}
          </div>
        `;
      }).join('');

      epgBox.innerHTML = `<h3>ðŸ“º Jadual Rancangan Astro Ria (Hari Ini)</h3>${html}`;
    })
    .catch(error => {
      console.error("EPG Fetch Error:", error);
      document.getElementById("epg-astro-ria").innerHTML = "<p>Gagal memuatkan jadual rancangan.</p>";
    });
</script>


<!-- âœ… END EPG SECTION -->
