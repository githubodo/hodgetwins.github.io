<!-- âœ… START EPG SECTION FOR ASTRO RIA -->
<div id="epg-astro-ria" class="epg-box">
  <p>Muatkan jadual rancangan Astro Ria...</p>
</div>

<style>
  .epg-box {
    background: #111;
    color: #eee;
    padding: 20px;
    border-radius: 12px;
    margin-top: 30px;
    font-family: Arial, sans-serif;
  }
  .epg-box h3 {
    font-size: 1.2rem;
    margin-bottom: 12px;
    border-bottom: 1px solid #444;
    padding-bottom: 6px;
    color: #0ff;
  }
  .epg-item {
    margin-bottom: 14px;
    padding-bottom: 8px;
    border-bottom: 1px dotted #333;
  }
  .epg-item strong {
    color: #ffd700;
  }
  .epg-item small {
    display: block;
    color: #ccc;
    margin-top: 4px;
    line-height: 1.4;
  }
</style>

<script>
  fetch("https://epg.tvmalaysia.workers.dev/?channel=104.astro")
    .then(res => res.json())
    .then(data => {
      const epgBox = document.getElementById("epg-astro-ria");

      const nowUTC = new Date();
      const nowMY = new Date(nowUTC.getTime() + (8 * 60 * 60 * 1000)); // Malaysia time

      const todayMY = nowMY.toISOString().slice(0,10).replace(/-/g, "");

      const filtered = data.filter(item => {
        const startDate = item.start.slice(0, 8);
        const year = item.start.slice(0, 4);
        const month = item.start.slice(4, 6);
        const day = item.start.slice(6, 8);
        const hour = item.start.slice(8, 10);
        const minute = item.start.slice(10, 12);
        const second = item.start.slice(12, 14);
        const startTime = new Date(Date.UTC(year, month - 1, day, hour, minute, second) + (8 * 60 * 60 * 1000));
        return startDate === todayMY && startTime >= nowMY;
      });

      if (filtered.length === 0) {
        epgBox.innerHTML = "<p>Tiada rancangan akan datang untuk hari ini.</p>";
        return;
      }

      const html = filtered.map(item => {
        const rawTime = item.start.slice(8, 12);
        const hour = parseInt(rawTime.slice(0, 2));
        const minute = rawTime.slice(2, 4);
        const ampm = hour >= 12 ? 'PM' : 'AM';
        const hour12 = hour % 12 === 0 ? 12 : hour % 12;
        const formattedTime = `${hour12}:${minute} ${ampm}`;

        return `
          <div class="epg-item">
            <strong>${formattedTime}</strong> - ${item.title}
            <small>${item.desc}</small>
          </div>
        `;
      }).join('');

      epgBox.innerHTML = `<h3>ðŸ“º Jadual Rancangan Astro Ria (Hari Ini)</h3>${html}`;
    })
    .catch(error => {
      console.error("EPG Fetch Error:", error);
      document.getElementById("epg-astro-ria").innerHTML = "<p>Gagal memuatkan jadual rancangan.</p>";
    });
</script>
<!-- âœ… END EPG SECTION -->
